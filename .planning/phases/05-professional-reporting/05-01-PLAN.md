---
phase: 05-professional-reporting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/templates/report_professional.html
autonomous: true

must_haves:
  truths:
    - "Report displays Marsh branding with correct colors (--marsh-blue: #00263e, --marsh-light-blue: #0077c8)"
    - "Report includes red confidential banner at top"
    - "Report shows executive summary section with key findings cards"
    - "Report displays coverage summary table with all insurers and status badges"
    - "Report groups insurers by status priority (Critical, Watch, Monitor, Stable)"
    - "Report shows news items with icons, titles, impact tags, and source attribution"
    - "Report renders correctly on mobile (600px breakpoint)"
  artifacts:
    - path: "app/templates/report_professional.html"
      provides: "Professional Marsh-branded Jinja2 template"
      min_lines: 400
      contains: "--marsh-blue"
  key_links:
    - from: "app/templates/report_professional.html"
      to: "app/services/reporter.py"
      via: "Jinja2 Environment.get_template()"
      pattern: "get_template.*report_professional"
---

<objective>
Create professional Marsh-branded HTML template matching reference designs in RefChyt/.

Purpose: Transform basic report template into enterprise-grade responsive HTML matching Marsh branding guidelines.
Output: Complete Jinja2 template with all visual sections ready for data binding.
</objective>

<execution_context>
@C:\Users\taylo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\taylo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-professional-reporting/05-RESEARCH.md

Reference designs:
@RefChyt/2026-02-03_health_insurer_intelligence_report.html
@app/templates/report_basic.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create professional Jinja2 template with Marsh branding</name>
  <files>app/templates/report_professional.html</files>
  <action>
Create `app/templates/report_professional.html` as the comprehensive professional template.

Use RefChyt/2026-02-03_health_insurer_intelligence_report.html as the design reference.

**CSS Variables and Branding (copy exactly from reference):**
```css
:root {
    --marsh-blue: #00263e;
    --marsh-light-blue: #0077c8;
    --marsh-accent: #00a3e0;
    --alert-red: #dc3545;
    --alert-orange: #fd7e14;
    --alert-yellow: #ffc107;
    --success-green: #28a745;
    --neutral-gray: #6c757d;
}
```

**Required Sections (in order):**

1. **Confidential Banner** (REPT-03):
   - Red background (#dc3545), white text, centered
   - Text: "CONFIDENCIAL - USO INTERNO - MARSH BRASIL DDH INTELIGENCIA DE SEGURADORAS"

2. **Header** (REPT-02):
   - Gradient background from --marsh-blue to #005a87
   - Title: "Relatorio de Inteligencia - {{ category }}"
   - Subtitle: "Mercado Brasileiro de Seguros - Analise DDH"
   - Date badge with report_date

3. **Executive Summary Section** (REPT-04):
   - White card with left border (--marsh-light-blue)
   - Placeholder for AI-generated paragraph: {{ executive_summary_paragraph }}
   - Key findings grid (auto-fit, minmax 280px):
     - Critical card (red border, pink background)
     - Warning card (orange border, orange-tinted background)
     - Positive card (green border, green-tinted background)
   - Template loops through {{ key_findings }} with finding.severity, finding.title, finding.description

4. **Coverage Summary Table** (REPT-05):
   - White card with shadow
   - Table headers: Seguradora, Codigo ANS, Market Master, Produto, Status
   - Loop through {{ insurers }} displaying insurer.name, insurer.ans_code, insurer.market_master_code, insurer.category
   - Status badges with appropriate colors (status-critical, status-watch, status-monitor, status-stable)

5. **Insurer Sections by Status** (REPT-06, REPT-07):
   - Loop through status order: ['Critical', 'Watch', 'Monitor', 'Stable']
   - For each status with insurers:
     - Section header with status count
     - For each insurer:
       - Card with name, ANS code badge, status badge
       - For each news item:
         - News icon (use CSS background colors: icon-network, icon-financial, icon-regulatory, icon-crisis, icon-growth)
         - Title and meta (date, source)
         - Summary content with bullet points
         - Impact tag with severity class (impact-high, impact-medium, impact-low)
         - Category indicators if present (loop {{ news.category_indicators }})

6. **Market Context Section** (REPT-08):
   - Gray gradient background
   - Title: "Contexto de Mercado"
   - Placeholder paragraph: {{ market_context_paragraph }}
   - Context grid for regulatory items (if context_items provided)

7. **Strategic Recommendations Section** (REPT-09):
   - Dark blue background (--marsh-blue), white text
   - Title: "Recomendacoes Estrategicas"
   - Numbered list of recommendations: {{ recommendations }}

8. **Footer**:
   - Centered, gray text
   - Generation timestamp: {{ generation_timestamp }}
   - Confidentiality notice

**Mobile Responsive (REPT-11):**
Add @media queries at 600px breakpoint:
- Stack key-findings grid to single column
- Reduce header padding
- Stack insurer-header flex items
- Make table horizontally scrollable
- Reduce container padding

**Print Styles:**
- Force background colors with -webkit-print-color-adjust
- Prevent page breaks inside insurer-section

**Template Variables Expected:**
- category: str
- report_date: str (formatted)
- executive_summary_paragraph: str (AI-generated)
- key_findings: list[{severity, title, description}]
- insurers: list[Insurer]
- insurers_by_status: dict[str, list[Insurer]]
- status_counts: dict[str, int]
- market_context_paragraph: str
- context_items: list[{title, description}] (optional)
- recommendations: list[str]
- generation_timestamp: str

**Use Portuguese labels throughout:**
- "Resumo Executivo"
- "Resumo de Cobertura DDH"
- "Contexto de Mercado"
- "Recomendacoes Estrategicas"
- "Seguradora", "Codigo ANS", "Produto", "Status"
- "Fonte:" for source attribution

**Category Indicator Mapping (for display):**
Map these indicator codes to Portuguese labels in template:
- regulatory_action -> "Acao Regulatoria"
- financial_crisis -> "Crise Financeira"
- leadership_change -> "Mudanca de Lideranca"
- merger_acquisition -> "Fusao/Aquisicao"
- network_change -> "Mudanca de Rede"
- customer_complaints -> "Reclamacoes de Clientes"
- rate_increase -> "Aumento de Preco"
- market_expansion -> "Expansao de Mercado"
- partnership -> "Parceria"
- innovation -> "Inovacao"
  </action>
  <verify>
File exists: `test -f app/templates/report_professional.html && echo "Template exists"`
Contains Marsh branding: `grep -c "marsh-blue" app/templates/report_professional.html` returns > 5
Contains all sections: `grep -c "executive-summary\|coverage-table\|insurer-section\|market-context\|recommendations" app/templates/report_professional.html` returns 5
Has mobile breakpoint: `grep -c "@media.*600px" app/templates/report_professional.html` returns >= 1
Has Portuguese labels: `grep -c "Resumo Executivo\|Contexto de Mercado\|Recomendacoes" app/templates/report_professional.html` returns 3
  </verify>
  <done>
Template file exists at app/templates/report_professional.html with:
- Marsh branding CSS variables
- Red confidential banner
- Executive summary with key findings cards
- Coverage summary table
- Insurer sections grouped by status priority
- News items with icons, impact tags, category indicators
- Market context section
- Strategic recommendations section
- Mobile responsive media queries at 600px
- Portuguese labels throughout
  </done>
</task>

</tasks>

<verification>
1. Template file exists and is well-formed HTML
2. CSS variables match Marsh branding exactly
3. All required sections present
4. Mobile breakpoint implemented
5. Print styles included
6. Template variables use correct names for data binding
</verification>

<success_criteria>
- Template renders without Jinja2 syntax errors
- Visual inspection of rendered HTML matches reference design structure
- Mobile view stacks elements correctly at 600px width
- All Portuguese labels present
</success_criteria>

<output>
After completion, create `.planning/phases/05-professional-reporting/05-01-SUMMARY.md`
</output>
