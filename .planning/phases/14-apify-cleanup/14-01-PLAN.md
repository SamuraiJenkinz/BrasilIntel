---
phase: 14-apify-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/services/sources/__init__.py
  - app/services/sources/base.py
  - app/services/sources/google_news.py
  - app/services/sources/valor.py
  - app/services/sources/cqcs.py
  - app/services/sources/infomoney.py
  - app/services/sources/estadao.py
  - app/services/sources/ans.py
  - app/services/sources/rss_source.py
  - app/services/scraper.py
  - app/services/batch_processor.py
  - app/services/relevance_scorer.py
  - app/services/__init__.py
  - requirements.txt
  - tests/test_batch_processor.py
  - tests/test_relevance_scorer.py
autonomous: true

must_haves:
  truths:
    - "No Apify source class files exist anywhere in the codebase"
    - "requirements.txt contains no apify-client or feedparser entries"
    - "app/services/__init__.py imports no Apify-related modules"
    - "Dead code services (scraper, batch_processor, relevance_scorer) are removed"
  artifacts:
    - path: "app/services/__init__.py"
      provides: "Clean services package with no Apify imports"
      contains: "ClassificationService"
    - path: "requirements.txt"
      provides: "Dependencies without Apify/scraping packages"
  key_links:
    - from: "app/services/__init__.py"
      to: "app/services/classifier.py"
      via: "import statement"
      pattern: "from app\\.services\\.classifier import"
---

<objective>
Delete all Apify source class files, dead scraper/batch/relevance services, their tests, and remove Apify dependencies from requirements.txt. Clean the services package __init__.py to remove the ApifyScraperService import.

Purpose: Remove the bulk of dead Apify infrastructure (files and dependencies) so the codebase reflects Factiva as the sole collection mechanism.
Output: 9 source files deleted, 3 dead service files deleted, 2 dead test files deleted, 2 dependencies removed, services __init__ cleaned.
</objective>

<execution_context>
@C:\Users\taylo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\taylo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-apify-cleanup/14-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete Apify source directory and dead service files</name>
  <files>
    app/services/sources/ (entire directory — 8 files)
    app/services/scraper.py
    app/services/batch_processor.py
    app/services/relevance_scorer.py
    tests/test_batch_processor.py
    tests/test_relevance_scorer.py
  </files>
  <action>
    Delete the entire `app/services/sources/` directory (contains __init__.py, base.py, google_news.py, valor.py, cqcs.py, infomoney.py, estadao.py, ans.py, rss_source.py — all Apify source classes).

    Delete `app/services/scraper.py` — contains ApifyScraperService and ScraperService classes, both dead code since Phase 11 switched to Factiva-only pipeline.

    Delete `app/services/batch_processor.py` — dead code, only called by ScraperService which is being deleted.

    Delete `app/services/relevance_scorer.py` — dead code, only imported by scraper.py (being deleted). It imports ScrapedNewsItem from the sources package (being deleted). No other consumer in the codebase.

    Delete `tests/test_batch_processor.py` — tests dead code (BatchProcessor).

    Delete `tests/test_relevance_scorer.py` — tests dead code (RelevanceScorer), also imports ScrapedNewsItem from sources package.

    Use `rm -rf` for the sources directory, `rm` for individual files.

    DO NOT delete `app/services/deduplicator.py` or `app/services/insurer_matcher.py` — these are Factiva pipeline services.
  </action>
  <verify>
    Confirm directory/files are gone:
    - `ls app/services/sources/` should fail (directory does not exist)
    - `ls app/services/scraper.py` should fail
    - `ls app/services/batch_processor.py` should fail
    - `ls app/services/relevance_scorer.py` should fail
    - `ls tests/test_batch_processor.py` should fail
    - `ls tests/test_relevance_scorer.py` should fail
    - `ls app/services/classifier.py` should succeed (not deleted)
    - `ls app/services/deduplicator.py` should succeed (not deleted)
  </verify>
  <done>All 9 source files, 3 dead service files, and 2 dead test files are deleted from disk. No Apify source class exists in the codebase.</done>
</task>

<task type="auto">
  <name>Task 2: Clean services __init__ and remove dependencies</name>
  <files>
    app/services/__init__.py
    requirements.txt
  </files>
  <action>
    **app/services/__init__.py** — Remove the ApifyScraperService import line:
    ```
    from app.services.scraper import ApifyScraperService
    ```
    Leave the remaining imports (excel_service, classifier, emailer, reporter) untouched. The file should look like:
    ```python
    # BrasilIntel Business Services Package
    from app.services.excel_service import parse_excel_insurers, generate_excel_export
    from app.services.classifier import ClassificationService
    from app.services.emailer import GraphEmailService
    from app.services.reporter import ReportService
    ```

    **requirements.txt** — Remove these two lines:
    - `apify-client>=1.8.0` (under "# Phase 2 - Vertical Slice / # Web scraping" comment)
    - `feedparser>=6.0.0` (under "# Phase 3 - News Collection Scale" comment)

    Also remove the associated comments that are now orphaned:
    - `# Phase 2 - Vertical Slice` and `# Web scraping` (lines 19-20) — these only introduced apify-client
    - The `# Phase 3 - News Collection Scale` comment (line 42) becomes the header for just `aiohttp>=3.9.0`

    Keep `aiohttp>=3.9.0` — it is used by FactivaCollector, NOT just Apify sources.

    DO NOT remove any other dependencies.
  </action>
  <verify>
    - `grep -i "apify\|scraper" app/services/__init__.py` returns no matches
    - `grep -i "apify-client\|feedparser" requirements.txt` returns no matches
    - `grep "aiohttp" requirements.txt` still returns a match (aiohttp kept)
    - `python -c "from app.services import ClassificationService; print('OK')"` succeeds
  </verify>
  <done>app/services/__init__.py has no Apify imports. requirements.txt has no apify-client or feedparser entries. aiohttp is preserved.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `ls app/services/sources/` fails — directory removed
2. `grep -ri "apify-client\|feedparser" requirements.txt` — no matches
3. `grep -ri "ApifyScraperService\|ScraperService\|BatchProcessor\|RelevanceScorer" app/services/__init__.py` — no matches
4. `ls app/services/classifier.py app/services/deduplicator.py app/services/insurer_matcher.py` — all exist (Factiva services preserved)
</verification>

<success_criteria>
- 14 files deleted (9 source + 3 service + 2 test)
- app/services/sources/ directory no longer exists
- requirements.txt has no Apify/scraping dependencies
- app/services/__init__.py imports only active services
- No import errors from remaining service files
</success_criteria>

<output>
After completion, create `.planning/phases/14-apify-cleanup/14-01-SUMMARY.md`
</output>
